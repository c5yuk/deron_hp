<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<script type="text/javascript">

var api_key = '7b18731dfad050ca';

function do_search (){
		document.getElementById( 'result' ).innerHTML = 'loading...';

var keyword = document.getElementById( 'keyword' ).value;
	var url = 'http://webservice.recruit.co.jp/ab-road/tour/v1/'
	+ '?format=jsonp&callback=my_callback&'
	+ 'key=' + api_key + '&'
	+ 'keyword=' + encodeURIComponent( keyword ) + '&'
	+ 'order=1';

	var script     = document.createElement( 'script' );
	script.type    = 'text/javascript';
	script.charset = 'utf-8';
	script.src     = url;
	document.getElementsByTagName("head")[0].appendChild( script );
	
	}

function my_callback (json){
		var tree = json.results;

		var tgt = document.getElementById( 'result' );
	if( tree.error ){
		tgt.innerHTML = '<p class="error">'
			+ json.results.error[0].message + '</p>';
		return;
	}else if( tree.results_returned == 0 ){
		tgt.innerHTML = '<p class="error">'
			+ '該当するツアーはありませんでした</p>';
		return;
	}

	var html = '<p><span class="results_available">'
		+ tree.results_available + '</span> 件見つかりました！(・∪・)</p>';
	html += '<ol>';
	for (var i=0; i<tree.tour.length; i++){
		var itm = tree.tour[ i ];
		var text = itm.price.min + '円～ ' + itm.title;
		text = text.substr( 0, 35 );
		html += '<li><a href="' + itm.urls.pc
			+ '">' + text + '...</a></li>';
	}
	html += '</ol>';
	tgt.innerHTML = html;
}

</script>
</head>
<body>
<div id="container">
	<div id="header">
	<h1>
    リクルート webサービス AB-ROAD API ツアー検索
    </h1>
    <p>
    気になる国の名前を入力すると、その国のツアープランが表示されるよ！
    </p>
    </div>
	<div id="forms">
		<form method="get" action="javascript:do_search()">
		<input type="text" class="input_text" id="keyword"
			value="フランス" />
		<input type="submit" value="検索"/>
		</form>
	</div>
	<div id="result"></div>
</div>
</body>
</html>
